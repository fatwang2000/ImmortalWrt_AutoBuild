SUCCESS_LIST=""
FAIL_LOGS=""
mkdir -p ./firmware_artifacts

for d in ./artifacts/*; do
  for f in "$d"/*; do
    fname=$(basename "$f")
    if [[ "$fname" == *.zip ]]; then
      cp "$f" ./firmware_artifacts/
      SUCCESS_LIST="$SUCCESS_LIST\n- $fname"
    elif [[ "$fname" == build.log ]]; then
      FAIL_LOGS="$FAIL_LOGS\n==== $fname ====\n$(cat "$f")"
    fi
  done
done

# 输出成功列表
{
  echo "success_artifacts<<EOF"
  echo -e "$SUCCESS_LIST"
  echo "EOF"
} >> "$GITHUB_OUTPUT"

# 输出失败日志
{
  echo "fail_logs<<EOF"
  echo -e "$FAIL_LOGS"
  echo "EOF"
} >> "$GITHUB_OUTPUT"
